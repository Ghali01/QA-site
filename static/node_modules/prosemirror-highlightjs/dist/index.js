(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{DecorationCache:()=>c,getHighlightDecorations:()=>r,highlightPlugin:()=>s});const n=require("prosemirror-view");var o=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};function r(e,t,r,a,u){if(!(e&&e.nodeSize&&(null==r?void 0:r.length)&&a))return[];var c=function(e,t){var n=[];return t.includes("doc")&&n.push({node:e,pos:-1}),e.descendants((function(e,o){if(e.isBlock&&t.indexOf(e.type.name)>-1)return n.push({node:e,pos:o}),!1})),n}(e,r),s=[];return c.forEach((function(e){if(null==u?void 0:u.preRenderer){var r=u.preRenderer(e.node,e.pos);if(r)return void(s=o(o([],s,!0),r,!0))}var c=a(e.node);if(!c||t.getLanguage(c)){var d=c?t.highlight(e.node.textContent,{language:c}):t.highlightAuto(e.node.textContent);!c&&d.language&&(null==u?void 0:u.autohighlightCallback)&&u.autohighlightCallback(e.node,e.pos,d.language);var l=d._emitter,p=new i(l,e.pos,l.options.classPrefix).value(),f=[];p.forEach((function(e){if(e.kind){var t=n.Decoration.inline(e.from,e.to,{class:e.classes});f.push(t)}})),(null==u?void 0:u.postRenderer)&&u.postRenderer(e.node,e.pos,f),s=o(o([],s,!0),f,!0)}})),s}var i=function(){function e(e,t,n){this.buffer=[],this.nodeQueue=[],this.classPrefix=n,this.currentPosition=t+1,e.walk(this)}return Object.defineProperty(e.prototype,"currentNode",{get:function(){return this.nodeQueue.length?this.nodeQueue.slice(-1):null},enumerable:!1,configurable:!0}),e.prototype.addText=function(e){this.currentNode&&(this.currentPosition+=e.length)},e.prototype.openNode=function(e){var t=e.kind||"";t=e.sublanguage?"language-"+t:this.expandScopeName(t);var n=this.newNode();n.kind=e.kind,n.classes=t,n.from=this.currentPosition,this.nodeQueue.push(n)},e.prototype.closeNode=function(e){var t=this.nodeQueue.pop();if(!t)throw"Cannot close node!";if(t.to=this.currentPosition,e.kind!==t.kind)throw"Mismatch!";this.buffer.push(t)},e.prototype.value=function(){return this.buffer},e.prototype.newNode=function(){return{from:0,to:0,kind:void 0,classes:""}},e.prototype.expandScopeName=function(e){if(e.includes(".")){var t=e.split(".");return o([""+this.classPrefix+t.shift()],t.map((function(e,t){return""+e+"_".repeat(t+1)})),!0).join(" ")}return""+this.classPrefix+e},e}();const a=require("prosemirror-state");var u=function(){return(u=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},c=function(){function e(e){this.cache=u({},e)}return e.prototype.get=function(e){return this.cache[e]||null},e.prototype.set=function(e,t,n){e<0||(this.cache[e]={node:t,decorations:n})},e.prototype.replace=function(e,t,n,o){this.remove(e),this.set(t,n,o)},e.prototype.remove=function(e){delete this.cache[e]},e.prototype.invalidate=function(t){var n=this,o=new e(this.cache),r=t.mapping;return Object.keys(this.cache).forEach((function(e){var i=+e;if(!(i<0)){var a=r.mapResult(i),u=t.doc.nodeAt(a.pos),c=n.get(i),s=c.node,d=c.decorations;if(a.deleted||!(null==u?void 0:u.eq(s)))o.remove(i);else if(i!==a.pos){var l=d.map((function(e){return e.map(r,0,0)})).filter((function(e){return null!==e}));o.replace(i,a.pos,u,l)}}})),o},e}();function s(e,t,o,i){void 0===t&&(t=["code_block"]);var u=o||function(e){var t=e.attrs.detectedHighlightLanguage,n=e.attrs.params;return t||(null==n?void 0:n.split(" ")[0])||""},s=i||function(e,t,n,o){var r=t.attrs||{};return r.detectedHighlightLanguage=o,e.setNodeMarkup(n,void 0,r)},d=function(n,o){var i=[];return{content:r(n,e,t,u,{preRenderer:function(e,t){var n;return null===(n=o.get(t))||void 0===n?void 0:n.decorations},postRenderer:function(e,t,n){o.set(t,e,n)},autohighlightCallback:function(e,t,n){i.push({node:e,pos:t,language:n})}}),autodetectedLanguages:i}},l=new a.PluginKey;return new a.Plugin({key:l,state:{init:function(e,t){var o=new c({}),r=d(t.doc,o);return{cache:o,decorations:n.DecorationSet.create(t.doc,r.content),autodetectedLanguages:r.autodetectedLanguages}},apply:function(e,t){var o=t.cache.invalidate(e);if(!e.docChanged)return{cache:o,decorations:t.decorations.map(e.mapping,e.doc),autodetectedLanguages:[]};var r=d(e.doc,o);return{cache:o,decorations:n.DecorationSet.create(e.doc,r.content),autodetectedLanguages:r.autodetectedLanguages}}},props:{decorations:function(e){return this.getState(e).decorations}},view:function(e){var t=function(e){var t=l.getState(e.state);if(t&&t.autodetectedLanguages.length){var n=e.state.tr;t.autodetectedLanguages.forEach((function(e){if(e.language){var t=s(n,e.node,e.pos,e.language);n=t||n}})),n=n.setMeta("addToHistory",!1),e.dispatch(n)}};return t(e),{update:t}}})}var d=exports;for(var l in t)d[l]=t[l];t.__esModule&&Object.defineProperty(d,"__esModule",{value:!0})})();